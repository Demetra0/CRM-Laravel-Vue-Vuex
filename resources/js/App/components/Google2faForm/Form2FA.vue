<template>
    <b-form>

        <b-form-group
            id="input-group-1"
            label="Login Google 2FA"
            label-for="input-1"
        >

            <b-input-group>
                <b-form-input
                    id="input-1"
                    v-model="form.code"
                    type="text"
                    placeholder="Enter code"
                    required
                ></b-form-input>

                <b-input-group-append>
                    <b-button @click.prevent="login" type="submit">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                             xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0)">
                                <path
                                    d="M10.0004 20.0008C15.5235 20.0008 20.0008 15.5235 20.0008 10.0004C20.0008 4.47733 15.5235 0 10.0004 0C4.47733 0 0 4.47733 0 10.0004C0 15.5235 4.47733 20.0008 10.0004 20.0008Z"
                                    fill="#616161"/>
                                <path
                                    d="M10.0004 16.3641C6.48535 16.3641 3.63673 13.5155 3.63673 10.0004C3.63673 6.48535 6.48535 3.63673 10.0004 3.63673C11.7571 3.63673 13.3478 4.34909 14.5002 5.50062L17.0716 2.92921C15.2617 1.1193 12.7612 0 10.0004 0C4.47722 0 0 4.47721 0 10.0004C0 15.5236 4.47722 20.0008 10.0004 20.0008C12.762 20.0008 15.2617 18.8815 17.0724 17.0724L14.501 14.501C13.3478 15.6517 11.7571 16.3641 10.0004 16.3641Z"
                                    fill="#9E9E9E"/>
                                <path
                                    d="M16.3641 10.0004H13.1818C13.1818 8.24368 11.7571 6.81816 9.9996 6.81816C8.24207 6.81816 6.81816 8.24288 6.81816 10.0004C6.81816 10.8562 7.15661 11.6322 7.707 12.2052L7.70458 12.2076L11.6443 16.1473L11.6451 16.1481C14.3624 15.4229 16.3641 12.9457 16.3641 10.0004Z"
                                    fill="#424242"/>
                                <path
                                    d="M20 10.0004H16.3633C16.3633 12.9457 14.3608 15.4229 11.6451 16.1481L14.4534 18.9564C17.7412 17.3182 20 13.9232 20 10.0004Z"
                                    fill="#616161"/>
                                <path
                                    d="M10.0004 19.8864C4.49655 19.8864 0.0322334 15.4398 0.000805837 9.94319C0.000805837 9.96253 0 9.98106 0 10.0004C0 15.5236 4.47721 20.0008 10.0004 20.0008C15.5236 20.0008 20.0008 15.5236 20.0008 10.0004C20.0008 9.98106 20 9.96253 20 9.94319C19.9686 15.4398 15.5034 19.8864 10.0004 19.8864Z"
                                    fill="#212121" fill-opacity="0.1"/>
                                <path
                                    d="M11.6459 16.1481L11.7346 16.2368C14.4051 15.4825 16.3641 13.0279 16.3641 10.114V10.0004C16.3641 12.9457 14.3616 15.4229 11.6459 16.1481Z"
                                    fill="white" fill-opacity="0.05"/>
                                <path
                                    d="M18.1824 9.09106H10C9.49801 9.09106 9.09106 9.49802 9.09106 10.0001C9.09106 10.5021 9.49801 10.9091 10 10.9091H18.1816C18.6836 10.9091 19.0905 10.5021 19.0905 10.0001C19.0913 9.49802 18.6844 9.09106 18.1824 9.09106Z"
                                    fill="#9E9E9E"/>
                                <path opacity="0.5"
                                      d="M18.1824 9.09106H10C9.49801 9.09106 9.09106 9.49802 9.09106 10.0001C9.09106 10.5021 9.49801 10.9091 10 10.9091H18.1816C18.6836 10.9091 19.0905 10.5021 19.0905 10.0001C19.0913 9.49802 18.6844 9.09106 18.1824 9.09106Z"
                                      fill="#BDBDBD"/>
                                <path
                                    d="M1.81797 10.6821C2.19448 10.6821 2.4997 10.3769 2.4997 10.0004C2.4997 9.62389 2.19448 9.31867 1.81797 9.31867C1.44145 9.31867 1.13623 9.62389 1.13623 10.0004C1.13623 10.3769 1.44145 10.6821 1.81797 10.6821Z"
                                    fill="#BDBDBD"/>
                                <path
                                    d="M10.0004 2.4997C10.3769 2.4997 10.6821 2.19447 10.6821 1.81796C10.6821 1.44145 10.3769 1.13623 10.0004 1.13623C9.62389 1.13623 9.31866 1.44145 9.31866 1.81796C9.31866 2.19447 9.62389 2.4997 10.0004 2.4997Z"
                                    fill="#BDBDBD"/>
                                <path
                                    d="M10.0004 18.8638C10.3769 18.8638 10.6821 18.5586 10.6821 18.182C10.6821 17.8055 10.3769 17.5003 10.0004 17.5003C9.62389 17.5003 9.31866 17.8055 9.31866 18.182C9.31866 18.5586 9.62389 18.8638 10.0004 18.8638Z"
                                    fill="#BDBDBD"/>
                                <path
                                    d="M4.20485 4.89619C4.58136 4.89619 4.88659 4.59097 4.88659 4.21447C4.88659 3.83796 4.58136 3.53275 4.20485 3.53275C3.82834 3.53275 3.52312 3.83796 3.52312 4.21447C3.52312 4.59097 3.82834 4.89619 4.20485 4.89619Z"
                                    fill="#BDBDBD"/>
                                <path
                                    d="M4.20485 16.4777C4.58136 16.4777 4.88659 16.1725 4.88659 15.796C4.88659 15.4195 4.58136 15.1142 4.20485 15.1142C3.82834 15.1142 3.52312 15.4195 3.52312 15.796C3.52312 16.1725 3.82834 16.4777 4.20485 16.4777Z"
                                    fill="#BDBDBD"/>
                                <path
                                    d="M15.796 16.4777C16.1725 16.4777 16.4777 16.1725 16.4777 15.796C16.4777 15.4195 16.1725 15.1142 15.796 15.1142C15.4195 15.1142 15.1142 15.4195 15.1142 15.796C15.1142 16.1725 15.4195 16.4777 15.796 16.4777Z"
                                    fill="#757575"/>
                                <path
                                    d="M10.0004 9.20505H18.182C18.6647 9.20505 19.0596 9.58218 19.0878 10.0576C19.0886 10.0383 19.091 10.0197 19.091 10.0004C19.091 9.49837 18.6841 9.09142 18.182 9.09142H10.0004C9.49836 9.09142 9.09142 9.49837 9.09142 10.0004C9.09142 10.0197 9.09222 10.0383 9.09464 10.0576C9.12284 9.58218 9.5169 9.20505 10.0004 9.20505Z"
                                    fill="white" fill-opacity="0.2"/>
                                <path
                                    d="M19.0878 10.0568C19.058 10.5314 18.6639 10.9094 18.182 10.9094H10.0004C9.5177 10.9094 9.12284 10.5323 9.09464 10.0568C9.09222 10.0762 9.09142 10.0947 9.09142 10.1132C9.09142 10.6153 9.49836 11.0222 10.0004 11.0222H18.182C18.6841 11.0222 19.091 10.6153 19.091 10.1132C19.091 10.0947 19.0902 10.0762 19.0878 10.0568Z"
                                    fill="#212121" fill-opacity="0.2"/>
                                <path
                                    d="M10.0004 3.75032C11.7571 3.75032 13.3478 4.46268 14.5001 5.61422L17.1271 2.98559C17.1078 2.96625 17.0893 2.94691 17.0707 2.92837L14.5001 5.49979C13.3478 4.34825 11.7571 3.63589 10.0004 3.63589C6.48535 3.63589 3.63673 6.48452 3.63673 9.99957C3.63673 10.0189 3.63754 10.0374 3.63754 10.0568C3.66816 6.56832 6.50469 3.75032 10.0004 3.75032Z"
                                    fill="#212121" fill-opacity="0.1"/>
                                <path
                                    d="M10.0004 20.0008C15.5235 20.0008 20.0008 15.5235 20.0008 10.0004C20.0008 4.47733 15.5235 0 10.0004 0C4.47733 0 0 4.47733 0 10.0004C0 15.5235 4.47733 20.0008 10.0004 20.0008Z"
                                    fill="url(#paint0_radial)"/>
                            </g>
                            <defs>
                                <radialGradient id="paint0_radial" cx="0" cy="0" r="1"
                                                gradientUnits="userSpaceOnUse"
                                                gradientTransform="translate(2.93268 2.90991) scale(19.9663)">
                                    <stop stop-color="white" stop-opacity="0.1"/>
                                    <stop offset="1" stop-color="white" stop-opacity="0"/>
                                </radialGradient>
                                <clipPath id="clip0">
                                    <rect width="20" height="20" fill="white"/>
                                </clipPath>
                            </defs>
                        </svg>
                    </b-button>
                </b-input-group-append>
            </b-input-group>
        </b-form-group>
    </b-form>
</template>

<script>
import {login2fa} from "../../helper/google2fa";

export default {
    name: "Form2FA",
    data: () => ({
        form: {
            code: '',
            id: null
        },
    }),
    methods: {
        login() {
            this.form.id = this.$store.getters.currentUser.id
            this.form.code = this.form.code.replace(/\s/g, '')

            // Авторизация google 2fa
            login2fa(this.form)
                .then(res => {
                    this.$store.commit('setGoogle2fa')
                    this.$router.push('/users')
                })
                .catch(err => {
                    this.error = "Incorrect code"
                    this.$store.commit('google2faFailed')
                })
        }
    },

}
</script>

<style lang="scss">
.input-group-append .btn{
    background: #EFEFF4;
    border-radius: 20px;
    border: 0;
    &:hover, :active, :focus{
        background: #EFEFF4 !important;
        box-shadow: none !important;
        border: 0 !important;
    }
}
</style>
